@page
@using System.Globalization
@model CoreGymClub.Presentation.Pages.TrainingSessions.IndexModel

@{
    var isMember = User.Identity != null
                   && User.Identity.IsAuthenticated
                   && User.IsInRole("Member");

    var sv = new CultureInfo("sv-SE");
}

<div class="container mt-4">

    @* Alerts *@
    @if (TempData["Error"] is string e)
    {
        <div class="alert alert-danger">@e</div>
    }
    @if (TempData["Success"] is string ok)
    {
        <div class="alert alert-success">@ok</div>
    }

    @* Mina bokade pass *@
    @if (isMember)
    {
        <div class="mb-4">
            <h1 class="mb-3">Mina bokade pass</h1>

            @if (!Model.MyBookedSessions.Any())
            {
                <div class="alert alert-info">
                    Du har inga bokade pass.
                </div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table table-sm table-striped table-hover align-middle">
                        <thead class="thead-light">
                            <tr>
                                <th>Datum</th>
                                <th>Pass</th>
                                <th>Tid</th>
                                <th>Plats / instruktör</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var s in Model.MyBookedSessions
                                                .OrderBy(x => x.DateTimeStart.Date)
                                                .ThenBy(x => x.DateTimeStart))
                            {
                                <tr>
                                    <td>
                                        @s.DateTimeStart.ToString("d MMM yyyy", sv)
                                    </td>
                                    <td>
                                        <strong>@s.Title</strong>
                                    </td>
                                    <td>
                                        @s.DateTimeStart.ToString("t", sv)
                                        –
                                        @s.DateTimeEnd.ToString("t", sv)
                                    </td>
                                    <td>
                                        @s.Location • @s.Instructor
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>

        <hr />
    }

    @* Kommande träningspass *@
    <div class="mt-4">
        <h1 class="mb-3">Kommande träningspass</h1>

        @if (!Model.Sessions.Any())
        {
            <div class="alert alert-info">
                Inga tillgängliga träningspass.
            </div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table table-sm table-striped table-hover align-middle">
                    <thead class="thead-light">
                        <tr>
                            <th>Datum</th>
                            <th>Pass</th>
                            <th>Tid</th>
                            <th>Plats / instruktör</th>
                            <th>Platser kvar</th>
                            @if (isMember)
                            {
                                <th style="width: 1%;">Åtgärd</th>
                            }
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var s in Model.Sessions
                                            .OrderBy(x => x.DateTimeStart.Date)
                                            .ThenBy(x => x.DateTimeStart))
                        {
                            <tr>
                                <td>
                                    @s.DateTimeStart.ToString("d MMM yyyy", sv)
                                </td>
                                <td>
                                    <strong>@s.Title</strong>
                                </td>
                                <td>
                                    @s.DateTimeStart.ToString("t", sv)
                                    –
                                    @s.DateTimeEnd.ToString("t", sv)
                                </td>
                                <td>
                                    @s.Location • @s.Instructor
                                </td>
                                <td>
                                    @s.RemainingPlaces
                                </td>
                                @if (isMember)
                                {
                                    <td>
                                        @if (s.IsUserBooked)
                                        {
                                            <form method="post"
                                                  asp-page-handler="Unbook"
                                                  asp-route-id="@s.Id"
                                                  class="d-inline">
                                                <button type="submit"
                                                        class="btn btn-warning btn-sm">
                                                    Avboka
                                                </button>
                                            </form>
                                        }
                                        else if (s.IsFull)
                                        {
                                            <button class="btn btn-secondary btn-sm" disabled>
                                                Fullt
                                            </button>
                                        }
                                        else
                                        {
                                            <form method="post"
                                                  asp-page-handler="Book"
                                                  asp-route-id="@s.Id"
                                                  class="d-inline">
                                                <button type="submit"
                                                        class="btn btn-primary btn-sm">
                                                    Boka
                                                </button>
                                            </form>
                                        }
                                    </td>
                                }
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>

</div>

